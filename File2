USE databaseGO
SELECT      OBJECT_NAME(p.[object_id]) BlockedObjectFROM    sys.dm_exec_connections AS blocking    INNER JOIN sys.dm_exec_requests blocked        ON blocking.session_id = blocked.blocking_session_id    INNER JOIN sys.dm_os_waiting_tasks waitstats        ON waitstats.session_id = blocked.session_id    INNER JOIN sys.partitions p ON SUBSTRING(resource_description,         PATINDEX('%associatedObjectId%', resource_description) + 19,         LEN(resource_description)) = p.partition_id
SELECT db_name(rsc_dbid) AS 'DATABASE_NAME',case rsc_type when 1 then 'null'              when 2 then 'DATABASE'               WHEN 3 THEN 'FILE'              WHEN 4 THEN 'INDEX'              WHEN 5 THEN 'TABLE'              WHEN 6 THEN 'PAGE'              WHEN 7 THEN 'KEY'              WHEN 8 THEN 'EXTEND'              WHEN 9 THEN 'RID ( ROW ID)'              WHEN 10 THEN 'APPLICATION' end  AS 'REQUEST_TYPE',
CASE req_ownertype WHEN 1 THEN 'TRANSACTION'                   WHEN 2 THEN 'CURSOR'                   WHEN 3 THEN 'SESSION'                   WHEN 4 THEN 'ExSESSION' END AS 'REQUEST_OWNERTYPE',
OBJECT_NAME(rsc_objid ,rsc_dbid) AS 'OBJECT_NAME', PROCESS.HOSTNAME , PROCESS.program_name , PROCESS.nt_domain , PROCESS.nt_username , PROCESS.program_name ,SQLTEXT.text FROM sys.syslockinfo LOCK JOIN      sys.sysprocesses PROCESS  ON LOCK.req_spid = PROCESS.spidCROSS APPLY sys.dm_exec_sql_text(PROCESS.SQL_HANDLE) SQLTEXT
sp_who2
